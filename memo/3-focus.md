# フォーカス

　WebEditorのようにテキストエディタをHTML要素の一つとして複数配置するとき、キーバインドが重複してしまう問題がある。

　HTML要素フォーカスのキーバインドは`TAB`だが、テキストエディタにおける`TAB`キーはインデント入力だ。このバッティングをどう解決するか。

文脈|`TAB`|`Shift`+`TAB`
----|-----|-------------
HTML文書|次にフォーカスする|前にフォーカスする
エディタ|インデント(字下げ)|アンインデント(字上げ)

　尚、`<textarea>`ではインデントできない。代わりにフォーカスする。これはテキストエディタとして致命的な欠陥である。

　かといって、`keydown`イベントで愚直に`TAB`キーでインデント機能を実装したとしても、今度はフォーカスできなくなる。

　果たしてキーバインドの重複問題をどう解決するか。

# 対処案

1. 別のキーバインドを設定する
2. モード切替をして同一キーにする

## 1. 別のキーバインドを設定する

　たとえば以下のようにキーバインドを設定する。

動作|キーバインド
----|------------
次にフォーカスする|`TAB`
前にフォーカスする|`Shift`+`TAB`
インデント(字下げ)|`Ctrl` + `TAB`
アンインデント(字上げ)|`Ctrl` + `Shift` + `TAB`

　入力しづらい問題がある。`TAB`の代わりに十字キーを使えば`Ctrl`+`Shift`は回避できるだろうが、一般的な操作方法と異なるため判りにくく入力しづらい。

動作|キーバインド
----|------------
次にフォーカスする|`TAB`
前にフォーカスする|`Shift`+`TAB`
インデント(字下げ)|`Shift` + `→`
アンインデント(字上げ)|`Shift` + `←`

　どっちも`TAB`で入力できたほうが簡単だ。何かいい方法はないか。

## 2. モード切替をして同一キーにする

　vimのようにモード切替して、キーバインドも切り替える。

モード|`TAB`|`Shift`+`TAB`
------|-----|-------------
フォーカス|次にフォーカスする|前にフォーカスする
エディット|インデント(字下げ)|アンインデント(字上げ)

　フォーカスモード時、`TAB`が押された場合はそのままフォーカスする。それ以外のキーが押された場合、エディットモードに移行する。

　エディットモード時、`TAB`が押された場合はインデントする。`ESC`キーならフォーカスモードに移行する。

　これにて次の利点がある。

* HTMLフォーカス遷移時、他のUIと同様に`TAB`キーで遷移可
* テキスト入力時、一般的なエディタと同様に`TAB`キーでインデント可

　逆に次の欠点がある。

* モードを意識せねばならない
    * モードを視認できるよう実装せねばならない
        * モードを切替する方法を提示せねばならない

# text-box

　`<textarea>`をベースとしたWebComponent、`<text-box>`を自作する。

* モード(フォーカス/エディット)
* TAB, SHIFT+TAB

